#!/bin/sh

pidof -q gpu-screen-recorder && exit 0
window=$(kdotool getactivewindow)
window_name=$(kdotool getwindowname "$window" || kdotool getwindowclassname "$window" || echo "Game")
window_name="$(echo "$window_name" | awk '{for(i=1; i<=NF; i++) { if ($i ~ /[\(\)-]/) break; printf "%s", $i }}')"
window_name="$(echo "$window_name" | tr -cd '[:alnum:]')"
dunstify "GPU Screen Recorder" "Replay Started for: $window_name" && gpu-screen-recorder -w portal -restore-portal-session yes -c mkv -oc yes -a 'device:default_input|app-inverse:alsa_playback.librewolf|app-inverse:FireFox|app-inverse:ebur128.output|app-inverse:eq.output|app-inverse:mpv' -a "app-inverse:alsa_playback.librewolf|app-inverse:FireFox|app-inverse:ebur128.output|app-inverse:eq.output|app-inverse:mpv|app-inverse:Chromium" -a 'device:default_input' -a 'app:Chromium' -r 600 -restart-replay-on-save yes -k av1_10bit -tune quality -ac opus -fm content -f 120 -bm cbr -q 300000 -cr full -df yes -o "$HOME/Videos/Replay/$window_name" -keyint 1.0
#dunstify "GPU Screen Recorder" "Replay Started" && gpu-screen-recorder -w screen -c mkv -oc yes -a 'device:default_input|app-inverse:alsa_playback.librewolf|app-inverse:FireFox|app-inverse:ebur128.output|app-inverse:eq.output|app-inverse:mpv' -a "app-inverse:alsa_playback.librewolf|app-inverse:FireFox|app-inverse:ebur128.output|app-inverse:eq.output|app-inverse:mpv|app-inverse:Chromium" -a 'device:default_input' -a 'app:Chromium' -r 1800 -restart-replay-on-save yes -k av1_10bit -tune quality -ac opus -fm content -f 120 -q ultra -cr full -df yes -o "$HOME/Videos/Replay/$window_name" -keyint 1.0
