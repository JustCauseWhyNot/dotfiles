context.modules = [
	{ name = libpipewire-module-filter-chain
		args = {
			node.description = "Filtered Mic"
			media.name       = "Filtered Mic"
			filter.graph = {
				nodes = [
					{ type = lv2 name = compressor_mono plugin = "http://lsp-plug.in/plugins/lv2/compressor_mono" control = { g_in = 9.0 cr = 4.0 at = 10.0 rt = 60 } }
					{ type = lv2 name = limiter_mono plugin = "http://lsp-plug.in/plugins/lv2/limiter_mono" }
				]
				links = [
					{ output = "compressor_mono:out" input = "limiter_mono:in" }
				]
			}
			capture.props = {
				node.name = "effect_input.filter"
				node.target = "NoiseTorch Microphone for M Series"
			}
			playback.props = {
				node.name = "effect_output.filtered"
				media.class = Audio/Source
			}
		}
	}
]

#context.modules = [
#	{ name = libpipewire-module-filter-chain
#		args = {
#			node.description = "Filtered Mic"
#			media.name       = "Filtered Mic"
#			filter.graph = {
#				nodes = [
#					# The mixer node has been removed.
#					# Gain is now applied directly in the compressor as "input gain".
#					{
#						type    = lv2
#						name    = compressor_mono
#						plugin  = "http://lsp-plug.in/plugins/lv2/compressor_mono"
#						control = {
#							cr       = 4.0
#							at       = 10.0
#							rt       = 60
#							in_gain  = 9.0  # Applying +9dB input gain here
#						}
#					}
#					{
#						type   = lv2
#						name   = limiter_mono
#						plugin = "http://lsp-plug.in/plugins/lv2/limiter_mono"
#					}
#					{
#						type    = builtin
#						name    = mono_to_stereo
#						label   = mixer
#						control = {
#							"In 1 -> Out 1" = 1.0  # Route mono input to Left channel
#							"In 1 -> Out 2" = 1.0  # Route mono input to Right channel
#						}
#					}
#				]
#				links = [
#					# The link from the mixer is no longer needed.
#					# The graph now flows directly from the source into the compressor,
#					# and then from the compressor to the limiter.
#					{ output = "compressor_mono:out" input = "limiter_mono:in" }
#					{ output = "limiter_mono:out"    input = "mono_to_stereo:In 1" }
#				]
#			}
#			capture.props = {
#				node.name   = "effect_input.filter"
#				node.target = "NoiseTorch Microphone for M Series"
#			}
#			playback.props = {
#				node.name      = "effect_output.filtered"
#				media.class    = Audio/Source
#				audio.channels = 2
#				audio.position = [ "FL", "FR" ]
#			}
#		}
#	}
#]

#context.modules = [
#	{ name = libpipewire-module-filter-chain
#		args = {
#			node.description = "Filtered Mic"
#			media.name       = "Filtered Mic"
#			filter.graph = {
#				nodes = [
#					{
#						type    = lv2
#						name    = compressor_mono
#						plugin  = "http://lsp-plug.in/plugins/lv2/compressor_mono"
#						control = {
#							cr       = 4.0
#							at       = 10.0
#							rt       = 60
#							in_gain  = 9.0  # Applying +9dB input gain here
#						}
#					}
#					{
#						type   = lv2
#						name   = limiter_mono
#						plugin = "http://lsp-plug.in/plugins/lv2/limiter_mono"
#					}
#					{
#						type    = builtin
#						name    = mono_to_stereo
#						label   = mixer
#						control = {
#							"In 1 -> Out 1" = 1.0  # Route mono input to Left channel
#							"In 1 -> Out 2" = 1.0  # Route mono input to Right channel
#						}
#					}
#				]
#				links = [
#					# *** FIXED: Initial link from the source input to the compressor's input ***
#					{ output = "__in_0"              input = "compressor_mono:in" } 
#
#					{ output = "compressor_mono:out" input = "limiter_mono:in" }
#					{ output = "limiter_mono:out"    input = "mono_to_stereo:In 1" }
#				]
#			}
#			capture.props = {
#				node.name   = "effect_input.filter"
#				node.target = "NoiseTorch Microphone for M Series"
#			}
#			playback.props = {
#				node.name      = "effect_output.filtered"
#				media.class    = Audio/Source
#				audio.channels = 2
#				audio.position = [ "FL", "FR" ]
#			}
#		}
#	}
#]
