#context.properties = {
        #default.clock.allowed-rates [ 44100 48000 96000 ]
        #default.clock.min-quantum = 256
        #default.clock.max-quantum = 256
#}

# X2HR Headphone treatment
# SOFA spatialiser fed into autoEQ convolver

context.modules = [
	{ name = libpipewire-module-filter-chain
		args = {
		node.passive = out
		stream.dont-remix = true

		filter.graph = {
			nodes = [
			{
				type = sofa
				label = spatializer
				name = spFL
				config = {
					filename = "/home/justcausewhynot/.config/pipewire/pipewire.conf.d/subj_R.sofa"
				}
				control = {
					"Azimuth"    = 29.0
					"Elevation"  = -1.0
					"Radius"     = 2.0
				}
			}
			{
				type = sofa
				label = spatializer
				name = spFR
				config = {
					filename = "/home/justcausewhynot/.config/pipewire/pipewire.conf.d/subj_R.sofa"
					}
				control = {
					"Azimuth"    = 330.0
					"Elevation"  = 0.0
					"Radius"     = 3.0
				}
			}
			{
				type = sofa 
				label = spatializer
				name = spFC
				config = {
					filename = "/home/justcausewhynot/.config/pipewire/pipewire.conf.d/subj_R.sofa"
				}
				control = {
					"Azimuth"    = 0.0
					"Elevation"  = 0.0
					"Radius"     = 3.0
				}
			}
			{
				type = sofa
				label = spatializer
				name = spLFE
				config = {
					filename = "/home/justcausewhynot/.config/pipewire/pipewire.conf.d/subj_R.sofa"
				}
				control = {
					"Azimuth"    = 180.0
					"Elevation"  = 15.0
					"Radius"     = 3.0
				}
			}
			{
				type = sofa
				label = spatializer
				name = spRL
				config = {
					filename = "/home/justcausewhynot/.config/pipewire/pipewire.conf.d/subj_R.sofa"
				}
				control = {
					"Azimuth"    = 150.0
					"Elevation"  = 0.0
					"Radius"     = 3.0
				}
			}
			{
				type = sofa
				label = spatializer
				name = spRR
				config = {
					filename = "/home/justcausewhynot/.config/pipewire/pipewire.conf.d/subj_R.sofa"
				}
				control = {
					"Azimuth"    = 210.0
					"Elevation"  = 0.0
					"Radius"     = 3.0
				}
			}

			{
				type = builtin
				label = mixer
				name = mixL 
			}
			{
				type = builtin
				label = mixer
				name = mixR
			}
			{
				type   = builtin
				label  = convolver
				name   = X2HR-AutoEQL
				config = {
					#blocksize = ...
					#tailsize = 64
					#gain = 1.0
					delay = 0
					filename = "/home/justcausewhynot/.config/pipewire/pipewire.conf.d/x2hr.wav"
					#offset = ...
					#length = ...
					channel = 1
					resample_quality = 5
				}
			}
			{                        type   = builtin
                        label  = convolver
                        name   = X2HR-AutoEQR
                        config = {
                            #blocksize = ...
                            #tailsize = 64
                            #gain = 1.0
                            delay = 0
                            filename = "/home/justcausewhynot/.config/pipewire/pipewire.conf.d/x2hr.wav"
                            #offset = ...
                            #length = ...
                            channel = 2
                            resample_quality = 5

                        }
                    }
                ]

                links = [
                    # output
                    { output = "spFL:Out L"  input="mixL:In 1" }
                    { output = "spFL:Out R"  input="mixR:In 1" }

                    { output = "spFR:Out L"  input="mixL:In 2" }
                    { output = "spFR:Out R"  input="mixR:In 2" }

                    { output = "spFC:Out L"  input="mixL:In 3" }
                    { output = "spFC:Out R"  input="mixR:In 3" }

                    { output = "spLFE:Out L" input="mixL:In 4" }
                    { output = "spLFE:Out R" input="mixR:In 4" }

                    { output = "spRL:Out L"  input="mixL:In 5" }
                    { output = "spRL:Out R"  input="mixR:In 5" }

                    { output = "spRR:Out L"  input="mixL:In 6" }
                    { output = "spRR:Out R"  input="mixR:In 6" }

                    { output = "mixL:Out"    input="X2HR-AutoEQL:In" }
                    { output = "mixR:Out"    input="X2HR-AutoEQR:In" }
                ]

                inputs  = [ "spFL:In" "spFR:In" "spFC:In" "spLFE:In" "spRL:In" "spRR:In" ]
                outputs = [ "X2HR-AutoEQL:Out" "X2HR-AutoEQR:Out" ]
                 outputs = [ "mixL:Out" "mixR:Out" ]

            }

            capture.props = {
                media.class = Audio/Sink
                audio.channels = 6
                audio.position = [ FL FR ]
                node.name = "X2HR Treatment In"
                node.description = "X2HR Treatment In"
                node.virtual = false
                node.passive = out
                stream.dont-remix = true
                stream.properties = {
                    channelmix.upmix          = false
                    ## only "psd", "none" or "simple" values are accepted
                    channelmix.upmix-method   = none
                    channelmix.disable     = false
                    channelmix.normalize   = false
                    channelmix.lfe-cutoff  = 1000
                    channelmix.fc-cutoff   = 20000
                    channelmix.mix-lfe     = false
                    channelmix.rear-delay  = 0.0
                    channelmix.stereo-widen = 0.0
                    channelmix.hilbert-taps = 0
                }
            }

            playback.props = {
                node.name = "X2HR Treatment Out"
                node.description = "X2HR Treatment Out"
                node.passive = true
                audio.channels = 2
                audio.position = [ FL FR ]
                target.object = "alsa_output.usb-MOTU_M2_M2MT15C48F-00.HiFi__hw_M2__sink"
                stream.dont-remix = true
                stream.properties = {
                    channelmix.upmix          = false
                    ## only "psd", "none" or "simple" values are accepted
                    channelmix.upmix-method   = none
                    channelmix.disable     = false
                    channelmix.normalize   = false
                    channelmix.lfe-cutoff  = 1000
                    channelmix.fc-cutoff   = 20000
                    channelmix.mix-lfe     = false
                    channelmix.rear-delay  = 0.0
                    channelmix.stereo-widen = 0.0
                    channelmix.hilbert-taps = 0
                }
            }
        }
    }

]

#    { name = libpipewire-module-filter-chain
#        args = {
#            filter.graph = {
#                nodes = [
#                    # duplicate inputs
#                    { type = builtin label = copy name = copyFL  }
#                    { type = builtin label = copy name = copyFR  }
#                    { type = builtin label = copy name = copyFC  }
#                    { type = builtin label = copy name = copyRL  }
#                    { type = builtin label = copy name = copyRR  }
#                    { type = builtin label = copy name = copySL  }
#                    { type = builtin label = copy name = copySR  }
#                    { type = builtin label = copy name = copyLFE }
#
#                    # apply hrir - HeSuVi 14-channel WAV (not the *-.wav variants) (note: */44/* in HeSuVi are the same, but resampled to 44100)
#                    { type = builtin label = convolver name = convFL_L config = { filename = "/etc/pipewire/pipewire.conf.d/atmos.wav" channel =  0 } }
#                    { type = builtin label = convolver name = convFL_R config = { filename = "/etc/pipewire/pipewire.conf.d/atmos.wav" channel =  1 } }
#                    { type = builtin label = convolver name = convSL_L config = { filename = "/etc/pipewire/pipewire.conf.d/atmos.wav" channel =  2 } }
#                    { type = builtin label = convolver name = convSL_R config = { filename = "/etc/pipewire/pipewire.conf.d/atmos.wav" channel =  3 } }
#                    { type = builtin label = convolver name = convRL_L config = { filename = "/etc/pipewire/pipewire.conf.d/atmos.wav" channel =  4 } }
#                    { type = builtin label = convolver name = convRL_R config = { filename = "/etc/pipewire/pipewire.conf.d/atmos.wav" channel =  5 } }
#                    { type = builtin label = convolver name = convFC_L config = { filename = "/etc/pipewire/pipewire.conf.d/atmos.wav" channel =  6 } }
#                    { type = builtin label = convolver name = convFR_R config = { filename = "/etc/pipewire/pipewire.conf.d/atmos.wav" channel =  7 } }
#                    { type = builtin label = convolver name = convFR_L config = { filename = "/etc/pipewire/pipewire.conf.d/atmos.wav" channel =  8 } }
#                    { type = builtin label = convolver name = convSR_R config = { filename = "/etc/pipewire/pipewire.conf.d/atmos.wav" channel =  9 } }
#                    { type = builtin label = convolver name = convSR_L config = { filename = "/etc/pipewire/pipewire.conf.d/atmos.wav" channel = 10 } }
#                    { type = builtin label = convolver name = convRR_R config = { filename = "/etc/pipewire/pipewire.conf.d/atmos.wav" channel = 11 } }
#                    { type = builtin label = convolver name = convRR_L config = { filename = "/etc/pipewire/pipewire.conf.d/atmos.wav" channel = 12 } }
#                    { type = builtin label = convolver name = convFC_R config = { filename = "/etc/pipewire/pipewire.conf.d/atmos.wav" channel = 13 } }
#
#                    # treat LFE as FC
#                    { type = builtin label = convolver name = convLFE_L config = { filename = "/etc/pipewire/pipewire.conf.d/atmos.wav" channel =  6 } }
#                    { type = builtin label = convolver name = convLFE_R config = { filename = "/etc/pipewire/pipewire.conf.d/atmos.wav" channel = 13 } }
#
#                    # stereo output
#                    { type = builtin label = mixer name = mixL }
#                    { type = builtin label = mixer name = mixR }
#                    
#                    {
#                        type  = builtin
#                        name  = eq_band_1
#                        label = bq_highshelf
#                        control = { "Freq" = 0 "Q" = 1.0 "Gain" = -5.4 }
#                    }
#                    {
#                        type  = builtin
#                        name  = eq_band_2
#                        label = bq_peaking
#                        control = { "Freq" = 52.0 "Q" = 2.0 "Gain" = -1.4 }
#                    }
#                    {
#                        type  = builtin
#                        name  = eq_band_3
#                        label = bq_peaking
#                        control = { "Freq" = 75.0 "Q" = 0.9 "Gain" = -4.5 }
#                    }
#                    {
#                        type  = builtin
#                        name  = eq_band_4
#                        label = bq_lowshelf
#                        control = { "Freq" = 105.0 "Q" = 0.71 "Gain" = 5.5 }
#                    }
#                    {
#                        type  = builtin
#                        name  = eq_band_5
#                        label = bq_peaking
#                        control = { "Freq" = 260.0 "Q" = 4.0 "Gain" = -1.5 }
#                    }
#                    {
#                        type  = builtin
#                        name  = eq_band_6
#                        label = bq_highshelf
#                        control = { "Freq" = 1650.0 "Q" = 3.5 "Gain" = -3.9 }
#                    }
#                    {
#                        type  = builtin
#                        name  = eq_band_7
#                        label = bq_peaking
#                        control = { "Freq" = 2100.0 "Q" = 1.0 "Gain" = 2.6 }
#                    }
#                    {
#                        type  = builtin
#                        name  = eq_band_8
#                        label = bq_peaking
#                        control = { "Freq" = 2600.0 "Q" = 5.0 "Gain" = -1.1 }
#                    }
#                    {
#                        type  = builtin
#                        name  = eq_band_9
#                        label = bq_peaking
#                        control = { "Freq" = 5100.0 "Q" = 4.8 "Gain" = -4.7 }
#                    }
#                    {
#                        type  = builtin
#                        name  = eq_band_10
#                        label = bq_highshelf
#                        control = { "Freq" = 8000.0 "Q" = 0.71 "Gain" = 2.0 }
#                    }
#                    {
#                        type  = builtin
#                        name  = eq_band_11
#                        label = bq_peaking
#                        control = { "Freq" = 9000.0 "Q" = 4.0 "Gain" = 0.0 }
#                    }
#                    {
#                        type  = builtin
#                        name  = eq_band_1_r
#                        label = bq_highshelf
#                        control = { "Freq" = 0 "Q" = 1.0 "Gain" = -5.4 }
#                    }
#                    {
#                        type  = builtin
#                        name  = eq_band_2_r
#                        label = bq_peaking
#                        control = { "Freq" = 52.0 "Q" = 2.0 "Gain" = -1.4 }
#                    }
#                    {
#                        type  = builtin
#                        name  = eq_band_3_r
#                        label = bq_peaking
#                        control = { "Freq" = 75.0 "Q" = 0.9 "Gain" = -4.5 }
#                    }
#                    {
#                        type  = builtin
#                        name  = eq_band_4_r
#                        label = bq_lowshelf
#                        control = { "Freq" = 105.0 "Q" = 0.71 "Gain" = 5.5 }
#                    }
#                    {
#                        type  = builtin
#                        name  = eq_band_5_r
#                        label = bq_peaking
#                        control = { "Freq" = 260.0 "Q" = 4.0 "Gain" = -1.5 }
#                    }
#                    {
#                        type  = builtin
#                        name  = eq_band_6_r
#                        label = bq_highshelf
#                        control = { "Freq" = 1650.0 "Q" = 3.5 "Gain" = -3.9 }
#                    }
#                    {
#                        type  = builtin
#                        name  = eq_band_7_r
#                        label = bq_peaking
#                        control = { "Freq" = 2100.0 "Q" = 1.0 "Gain" = 2.6 }
#                    }
#                    {
#                        type  = builtin
#                        name  = eq_band_8_r
#                        label = bq_peaking
#                        control = { "Freq" = 2600.0 "Q" = 5.0 "Gain" = -1.1 }
#                    }
#                    {
#                        type  = builtin
#                        name  = eq_band_9_r
#                        label = bq_peaking
#                        control = { "Freq" = 5100.0 "Q" = 4.8 "Gain" = -4.7 }
#                    }
#                    {
#                        type  = builtin
#                        name  = eq_band_10_r
#                        label = bq_highshelf
#                        control = { "Freq" = 8000.0 "Q" = 0.71 "Gain" = 2.0 }
#                    }
#                    {
#                        type  = builtin
#                        name  = eq_band_11_r
#                        label = bq_peaking
#                        control = { "Freq" = 9000.0 "Q" = 4.0 "Gain" = 0.0 }
#                    }
#                ]
#                links = [
#                    # input
#                    { output = "copyFL:Out"  input="convFL_L:In"  }
#                    { output = "copyFL:Out"  input="convFL_R:In"  }
#                    { output = "copySL:Out"  input="convSL_L:In"  }
#                    { output = "copySL:Out"  input="convSL_R:In"  }
#                    { output = "copyRL:Out"  input="convRL_L:In"  }
#                    { output = "copyRL:Out"  input="convRL_R:In"  }
#                    { output = "copyFC:Out"  input="convFC_L:In"  }
#                    { output = "copyFR:Out"  input="convFR_R:In"  }
#                    { output = "copyFR:Out"  input="convFR_L:In"  }
#                    { output = "copySR:Out"  input="convSR_R:In"  }
#                    { output = "copySR:Out"  input="convSR_L:In"  }
#                    { output = "copyRR:Out"  input="convRR_R:In"  }
#                    { output = "copyRR:Out"  input="convRR_L:In"  }
#                    { output = "copyFC:Out"  input="convFC_R:In"  }
#                    { output = "copyLFE:Out" input="convLFE_L:In" }
#                    { output = "copyLFE:Out" input="convLFE_R:In" }
#
#                    # output
#                    { output = "convFL_L:Out"  input="mixL:In 1" }
#                    { output = "convFL_R:Out"  input="mixR:In 1" }
#                    { output = "convSL_L:Out"  input="mixL:In 2" }
#                    { output = "convSL_R:Out"  input="mixR:In 2" }
#                    { output = "convRL_L:Out"  input="mixL:In 3" }
#                    { output = "convRL_R:Out"  input="mixR:In 3" }
#                    { output = "convFC_L:Out"  input="mixL:In 4" }
#                    { output = "convFC_R:Out"  input="mixR:In 4" }
#                    { output = "convFR_R:Out"  input="mixR:In 5" }
#                    { output = "convFR_L:Out"  input="mixL:In 5" }
#                    { output = "convSR_R:Out"  input="mixR:In 6" }
#                    { output = "convSR_L:Out"  input="mixL:In 6" }
#                    { output = "convRR_R:Out"  input="mixR:In 7" }
#                    { output = "convRR_L:Out"  input="mixL:In 7" }
#                    { output = "convLFE_R:Out" input="mixR:In 8" }
#                    { output = "convLFE_L:Out" input="mixL:In 8" }
#
#                    # Surround out to EQ in
#                    { output = "mixL:Out" input="eq_band_1:In" }
#                    { output = "mixR:Out" input="eq_band_1_r:In" }
#
#                    # EQ Left
#                    { output = "eq_band_1:Out" input = "eq_band_2:In" }
#                    { output = "eq_band_2:Out" input = "eq_band_3:In" }
#                    { output = "eq_band_3:Out" input = "eq_band_4:In" }
#                    { output = "eq_band_4:Out" input = "eq_band_5:In" }
#                    { output = "eq_band_5:Out" input = "eq_band_6:In" }
#                    { output = "eq_band_6:Out" input = "eq_band_7:In" }
#                    { output = "eq_band_7:Out" input = "eq_band_8:In" }
#                    { output = "eq_band_8:Out" input = "eq_band_9:In" }
#                    { output = "eq_band_9:Out" input = "eq_band_10:In" }
#                    { output = "eq_band_10:Out" input = "eq_band_11:In" }
#                    # EQ Right
#                    { output = "eq_band_1_r:Out" input = "eq_band_2_r:In" }
#                    { output = "eq_band_2_r:Out" input = "eq_band_3_r:In" }
#                    { output = "eq_band_3_r:Out" input = "eq_band_4_r:In" }
#                    { output = "eq_band_4_r:Out" input = "eq_band_5_r:In" }
#                    { output = "eq_band_5_r:Out" input = "eq_band_6_r:In" }
#                    { output = "eq_band_6_r:Out" input = "eq_band_7_r:In" }
#                    { output = "eq_band_7_r:Out" input = "eq_band_8_r:In" }
#                    { output = "eq_band_8_r:Out" input = "eq_band_9_r:In" }
#                    { output = "eq_band_9_r:Out" input = "eq_band_10_r:In" }
#                    { output = "eq_band_10_r:Out" input = "eq_band_11_r:In" }
#                ]
#                inputs  = [ "copyFL:In" "copyFR:In" "copyFC:In" "copyLFE:In" "copyRL:In" "copyRR:In" "copySL:In" "copySR:In" ]
#                outputs = [ "eq_band_11:Out" "eq_band_11_r:Out" ]
#            }
#            capture.props = {
#                node.name      = "effect_input.virtual-surround-7.1-hesuvi"
#                media.class    = Audio/Sink
#                audio.channels = 8
#                audio.position = [ FL FR FC LFE RL RR SL SR ]
#            }
#            playback.props = {
#                node.name      = "effect_output.virtual-surround-7.1-hesuvi"
#                node.passive   = true
#                audio.channels = 2
#                audio.position = [ FL FR ]
#                stream.dont-remix = true
#                stream.properties = {
#                    channelmix.upmix          = false
#                    ## only "psd", "none" or "simple" values are accepted
#                    channelmix.upmix-method   = none
#                    channelmix.disable     = false
#                    channelmix.normalize   = false
#                    channelmix.lfe-cutoff  = 1000
#                    channelmix.fc-cutoff   = 20000
#                    channelmix.mix-lfe     = false
#                    channelmix.rear-delay  = 0.0
#                    channelmix.stereo-widen = 0.0
#                    channelmix.hilbert-taps = 0
#                }
#            }
#        }
#    }
#]
