#context.properties = {
        #default.clock.allowed-rates [ 44100 48000 96000 ]
        #default.clock.min-quantum = 256
        #default.clock.max-quantum = 256
#}

# X2HR Headphone treatment
# SOFA spatialiser fed into autoEQ convolver

context.modules = [
	{ name = libpipewire-module-filter-chain
		args = { 
			node.passive = out
			stream.dont-remix = true
				
			filter.graph = {
				nodes = [
				#{
				#	type = sofa
				#	label = spatializer
				#	name = spFL
				#	config = {
				#		filename = "/home/justcausewhynot/.config/pipewire/pipewire.conf.d/subj_R.sofa"
				#	}
				#	control = {
				#		"Azimuth"    = 29.0
				#		"Elevation"  = -1.0
				#		"Radius"     = 2.0
				#	}
				#}
				#{
				#	type = sofa
				#	label = spatializer
				#	name = spFR
				#	config = {
				#		filename = "/home/justcausewhynot/.config/pipewire/pipewire.conf.d/subj_R.sofa"
				#		}
				#	control = {
				#		"Azimuth"    = 330.0
				#		"Elevation"  = 0.0
				#		"Radius"     = 3.0
				#	}
				#}
				#{
				#	type = sofa 
				#	label = spatializer
				#	name = spFC
				#	config = {
				#		filename = "/home/justcausewhynot/.config/pipewire/pipewire.conf.d/subj_R.sofa"
				#	}
				#	control = {
				#		"Azimuth"    = 0.0
				#		"Elevation"  = 0.0
				#		"Radius"     = 3.0
				#	}
				#}
				#{
				#	type = sofa
				#	label = spatializer
				#	name = spLFE
				#	config = {
				#		filename = "/home/justcausewhynot/.config/pipewire/pipewire.conf.d/subj_R.sofa"
				#	}
				#	control = {
				#		"Azimuth"    = 180.0
				#		"Elevation"  = 15.0
				#		"Radius"     = 3.0
				#	}
				#}
				#{
				#	type = sofa
				#	label = spatializer
				#	name = spRL
				#	config = {
				#		filename = "/home/justcausewhynot/.config/pipewire/pipewire.conf.d/subj_R.sofa"
				#	}
				#	control = {
				#		"Azimuth"    = 150.0
				#		"Elevation"  = 0.0
				#		"Radius"     = 3.0
				#	}
				#}
				#{
				#	type = sofa
				#	label = spatializer
				#	name = spRR
				#	config = {
				#		filename = "/home/justcausewhynot/.config/pipewire/pipewire.conf.d/subj_R.sofa"
				#	}
				#	control = {
				#		"Azimuth"    = 210.0
				#		"Elevation"  = 0.0
				#		"Radius"     = 3.0
				#	}
				#}

				#{
				#	type = builtin
				#	label = mixer
				#	name = mixL 
				#}
				#{
				#	type = builtin
				#	label = mixer
				#	name = mixR
				#}
				{
					type   = builtin
					label  = convolver
					name   = X2HR-AutoEQL
					config = {
						#blocksize = ...
						#tailsize = 64
						#gain = 1.0
						delay = 0
						filename = "/home/justcausewhynot/.config/pipewire/pipewire.conf.d/x2hr.wav"
						#offset = ...
						#length = ...
						channel = 1
						resample_quality = 5
					}
				}
				{
					type   = builtin
					label  = convolver
					name   = X2HR-AutoEQR
					config = {
						#blocksize = ...
						#tailsize = 64
						#gain = 1.0
						delay = 0
						filename = "/home/justcausewhynot/.config/pipewire/pipewire.conf.d/x2hr.wav"
						#offset = ...
						#length = ...
						channel = 2
						resample_quality = 5
					}
				}
			]

			links = [
			# output
			#{ output = "spFL:Out L"  input="mixL:In 1" }
			#{ output = "spFL:Out R"  input="mixR:In 1" }

			#{ output = "spFR:Out L"  input="mixL:In 2" }
			#{ output = "spFR:Out R"  input="mixR:In 2" }

			#{ output = "spFC:Out L"  input="mixL:In 3" }
			#{ output = "spFC:Out R"  input="mixR:In 3" }

			#{ output = "spLFE:Out L" input="mixL:In 4" }
			#{ output = "spLFE:Out R" input="mixR:In 4" }

			#{ output = "spRL:Out L"  input="mixL:In 5" }
			#{ output = "spRL:Out R"  input="mixR:In 5" }

			#{ output = "spRR:Out L"  input="mixL:In 6" }
			#{ output = "spRR:Out R"  input="mixR:In 6" }

			#{ output = "mixL:Out"    input="X2HR-AutoEQL:In" }
			#{ output = "mixR:Out"    input="X2HR-AutoEQR:In" }
			]

			#inputs  = [ "spFL:In" "spFR:In" "spFC:In" "spLFE:In" "spRL:In" "spRR:In" ]
			outputs = [ "X2HR-AutoEQL:Out" "X2HR-AutoEQR:Out" ]
			#outputs = [ "mixL:Out" "mixR:Out" ]

			}

			capture.props = {
				media.class = Audio/Sink
				audio.channels = 2
				audio.position = [ FL FR ]
				node.name = "X2HR Treatment In"
				node.description = "X2HR Treatment In"
				node.virtual = false
				node.passive = out
				stream.dont-remix = true
				stream.properties = {
					channelmix.upmix          = false
					## only "psd", "none" or "simple" values are accepted
					channelmix.upmix-method   = none
					channelmix.disable     = false
					channelmix.normalize   = false
					channelmix.lfe-cutoff  = 1000
					channelmix.fc-cutoff   = 2000
					channelmix.mix-lfe     = false
					channelmix.rear-delay  = 0.0
					channelmix.stereo-widen = 0.0
					channelmix.hilbert-taps = 0
				}
			}

			playback.props = {
				node.name = "X2HR Treatment Out"
				node.description = "X2HR Treatment Out"
				node.passive = true
				audio.channels = 2
				audio.position = [ FL FR ]
				target.object = "alsa_output.usb-MOTU_M2_M2MT15C48F-00.HiFi__hw_M2__sink"
				stream.dont-remix = true
				stream.properties = {
					channelmix.upmix          = false
					## only "psd", "none" or "simple" values are accepted
					channelmix.upmix-method   = none
					channelmix.disable     = false
					channelmix.normalize   = false
					channelmix.lfe-cutoff  = 1000
					channelmix.fc-cutoff   = 20000
					channelmix.mix-lfe     = false
					channelmix.rear-delay  = 0.0
					channelmix.stereo-widen = 0.0
					channelmix.hilbert-taps = 0
					}
				}
			}
	}

]
